---
- name: Validate prometheus config
  ansible.builtin.command:
    cmd: "{{ prometheus_binary_install_dir }}/promtool check config {{ prometheus_config_dir }}/prometheus.yml"
  changed_when: false
  ignore_errors: "{{ ansible_check_mode }}"
  listen:
    - Reload prometheus
    - Restart prometheus

- name: Restart prometheus
  ansible.builtin.systemd_service:
    name: prometheus
    state: restarted
    daemon_reload: true
  ignore_errors: "{{ ansible_check_mode }}"

- name: Reload prometheus
  ansible.builtin.systemd_service:
    name: prometheus
    state: reloaded
  ignore_errors: "{{ ansible_check_mode }}"
